
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">datastores/avatar_store.go (83.7%)</option>
				
				<option value="file1">datastores/channel_store.go (76.2%)</option>
				
				<option value="file2">datastores/data_store.go (70.5%)</option>
				
				<option value="file3">datastores/emojis_store.go (84.6%)</option>
				
				<option value="file4">datastores/organisation_store.go (43.8%)</option>
				
				<option value="file5">datastores/parameter_store.go (86.7%)</option>
				
				<option value="file6">datastores/roles_store.go (75.9%)</option>
				
				<option value="file7">datastores/user_store.go (44.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">no coverage</span>
				<span class="cov1">low coverage</span>
				<span class="cov2">*</span>
				<span class="cov3">*</span>
				<span class="cov4">*</span>
				<span class="cov5">*</span>
				<span class="cov6">*</span>
				<span class="cov7">*</span>
				<span class="cov8">*</span>
				<span class="cov9">*</span>
				<span class="cov10">high coverage</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package datastores

import (
        "models"
        u "utils"
)

// AvatarStoreImpl Used to implement AvatarStore interface
type AvatarStoreImpl struct {
}

// NewAvatarStore Generate the struct for avatar store
func NewAvatarStore() AvatarStore <span class="cov1" title="1">{
        return &amp;AvatarStoreImpl{}
}</span>

// Save Use to save avatar in BB
func (asi AvatarStoreImpl) Save(avatar *models.Avatar, ds dbStore) *u.AppError <span class="cov10" title="36">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := avatar.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("avatarStoreImpl.Save.avatar.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov10" title="36">if !transaction.NewRecord(avatar) </span><span class="cov1" title="1">{
                transaction.Rollback()
                return u.NewLocAppError("avatarStoreImpl.Save", "save.transaction.create.already_exist", nil, "Avatar Name: "+avatar.Name)
        }</span>
        <span class="cov9" title="35">if err := transaction.Create(&amp;avatar).Error; err != nil </span><span class="cov7" title="11">{
                transaction.Rollback()
                return u.NewLocAppError("avatarStoreImpl.Save", "save.transaction.create.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov8" title="24">transaction.Commit()
        return nil</span>
}

// Update Used to update avatar in DB
func (asi AvatarStoreImpl) Update(avatar *models.Avatar, newAvatar *models.Avatar, ds dbStore) *u.AppError <span class="cov5" title="5">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := avatar.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("avatarStoreImpl.Update.avatarOld.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov5" title="5">if appError := newAvatar.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("avatarStoreImpl.Update.avatarNew.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov5" title="5">if err := transaction.Model(&amp;avatar).Updates(&amp;newAvatar).Error; err != nil </span><span class="cov2" title="2">{
                transaction.Rollback()
                return u.NewLocAppError("avatarStoreImpl.Update", "update.transaction.updates.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov3" title="3">transaction.Commit()
        return nil</span>
}

// GetAll Used to get avatar from DB
func (asi AvatarStoreImpl) GetAll(ds dbStore) *[]models.Avatar <span class="cov4" title="4">{
        db := *ds.Db
        avatars := []models.Avatar{}
        db.Find(&amp;avatars)
        return &amp;avatars
}</span>

// GetByName Used to get avatar from DB
func (asi AvatarStoreImpl) GetByName(avatarName string, ds dbStore) *models.Avatar <span class="cov5" title="6">{
        db := *ds.Db
        avatar := models.Avatar{}
        db.Where("name = ?", avatarName).First(&amp;avatar)
        return &amp;avatar
}</span>

// GetByLink Used to get avatar from DB
func (asi AvatarStoreImpl) GetByLink(avatarLink string, ds dbStore) *models.Avatar <span class="cov2" title="2">{
        db := *ds.Db
        avatar := models.Avatar{}
        db.Where("link = ?", avatarLink).First(&amp;avatar)
        return &amp;avatar
}</span>

// Delete Used to get avatar from DB
func (asi AvatarStoreImpl) Delete(avatar *models.Avatar, ds dbStore) *u.AppError <span class="cov3" title="3">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := avatar.IsValid(); appError != nil </span><span class="cov2" title="2">{
                transaction.Rollback()
                return u.NewLocAppError("avatarStoreImpl.Delete.avatar.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov1" title="1">if err := transaction.Delete(&amp;avatar).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("avatarStoreImpl.Delete", "update.transaction.delete.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov1" title="1">transaction.Commit()
        return nil</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package datastores

import (
        "models"
        u "utils"
)

// ChannelStoreImpl Used to implement ChannelStore interface
type ChannelStoreImpl struct {
        ChannelStore
}

// Save Use to save channel in BB
func (csi ChannelStoreImpl) Save(channel *models.Channel, ds dbStore) *u.AppError <span class="cov10" title="42">{
        db := *ds.Db
        transaction := db.Begin()
        channel.PreSave()
        if appError := channel.IsValid(false); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("channelStoreImpl.Save.channel.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov10" title="42">if !transaction.NewRecord(channel) </span><span class="cov1" title="1">{
                transaction.Rollback()
                return u.NewLocAppError("channelStoreImpl.Save", "save.transaction.create.already_exist", nil, "Channel Name: "+channel.ChannelName)
        }</span>
        <span class="cov9" title="41">if err := transaction.Create(&amp;channel).Error; err != nil </span><span class="cov1" title="1">{
                transaction.Rollback()
                return u.NewLocAppError("channelStoreImpl.Save", "save.transaction.create.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov9" title="40">transaction.Commit()
        return nil</span>
}

// Update Used to update channel in DB
func (csi ChannelStoreImpl) Update(channel *models.Channel, newChannel *models.Channel, ds dbStore) *u.AppError <span class="cov8" title="26">{
        db := *ds.Db
        transaction := db.Begin()
        newChannel.PreUpdate()
        newChannel.WebID = channel.WebID
        if appError := channel.IsValid(true); appError != nil </span><span class="cov7" title="13">{
                transaction.Rollback()
                return u.NewLocAppError("channelStoreImpl.Update.channelOld.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov7" title="13">if appError := newChannel.IsValid(true); appError != nil </span><span class="cov6" title="12">{
                transaction.Rollback()
                return u.NewLocAppError("channelStoreImpl.Update.channelNew.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>

        <span class="cov1" title="1">if err := transaction.Model(&amp;channel).Update(&amp;newChannel).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("channelStoreImpl.Update", "update.transaction.updates.encounterError :"+err.Error(), nil, "")
        }</span>

        <span class="cov1" title="1">if !newChannel.Private </span><span class="cov0" title="0">{
                if err := transaction.Model(&amp;channel).Updates("private", false).Error; err != nil </span><span class="cov0" title="0">{
                        transaction.Rollback()
                        return u.NewLocAppError("channelStoreImpl.Update", "update.transaction.updates.encounterError :"+err.Error(), nil, "")
                }</span>
        }
        <span class="cov1" title="1">transaction.Commit()
        return nil</span>
}

// GetAll Used to get channel from DB
func (csi ChannelStoreImpl) GetAll(ds dbStore) *[]models.Channel <span class="cov2" title="2">{
        db := *ds.Db
        channels := []models.Channel{}
        db.Find(&amp;channels)
        return &amp;channels
}</span>

// GetByName Used to get channel from DB
func (csi ChannelStoreImpl) GetByName(channelName string, ds dbStore) *models.Channel <span class="cov3" title="3">{
        db := *ds.Db
        channel := models.Channel{}
        db.Where("channelName = ?", channelName).First(&amp;channel)
        return &amp;channel
}</span>

// GetByType allow to find channels by types.
func (csi ChannelStoreImpl) GetByType(channelType string, ds dbStore) *[]models.Channel <span class="cov1" title="1">{
        db := *ds.Db
        channels := []models.Channel{}
        db.Where("type = ?", channelType).Find(&amp;channels)
        return &amp;channels
}</span>

// GetPublic allow to find publics channels.
func (csi ChannelStoreImpl) GetPublic(ds dbStore) *[]models.Channel <span class="cov0" title="0">{
        db := *ds.Db
        channels := []models.Channel{}
        db.Where("private = ?", false).Find(&amp;channels)
        return &amp;channels
}</span>

// GetPrivate allow to find publics channels.
func (csi ChannelStoreImpl) GetPrivate(ds dbStore) *[]models.Channel <span class="cov1" title="1">{
        db := *ds.Db
        channels := []models.Channel{}
        db.Where("private = ?", true).Find(&amp;channels)
        return &amp;channels
}</span>

// Delete Used to get channel from DB
func (csi ChannelStoreImpl) Delete(channel *models.Channel, ds dbStore) *u.AppError <span class="cov1" title="1">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := channel.IsValid(true); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("channelStoreImpl.Delete.channel.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov1" title="1">if err := transaction.Delete(&amp;channel).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("channelStoreImpl.Delete", "update.transaction.delete.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov1" title="1">transaction.Commit()
        return nil</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">/*Package datastores implements the basics databases communication functions used by PopCube chat api.

Stores

The following is a list of stores described:
        Avatar: Contain all informations for avatar management
        Channel: Contain all informations for channel management
        Emojis: Contain all informations for emojis management
        Organisation: Contain all informations for organisation management
        Parameter: Contain all informations for parmeters management
        Role: Contain all informations for roles management
        User: Contain all informations for users management
*/
// Created by Titouan FREVILLE &lt;titouanfreville@gmail.com&gt;
//
// Inspired by mattermost project
package datastores

import (
        "fmt"
        "models"
        u "utils"

        // Importing sql driver. They are used by gorm package and used by default from blank.
        _ "github.com/go-sql-driver/mysql"
        "github.com/jinzhu/gorm"
)

// dbStore Struct to manage Db knowledge
type dbStore struct {
        Db  *gorm.DB
        Err error
}

// InitConnection init Database connection &amp;&amp; database models
func (ds *dbStore) InitConnection(user string, dbname string, password string) <span class="cov10" title="7">{
        fmt.Printf("\n######## Intialisating Db conection  ########\n")
        connectionChain := user + ":" + password + "@(database:3306)/" + dbname + "?charset=utf8&amp;parseTime=True&amp;loc=Local"

        fmt.Printf("\nOpenning Db connection ......\n")
        db, err := gorm.Open("mysql", connectionChain)
        if err == nil </span><span class="cov10" title="7">{
                fmt.Printf("Connection openned\n")
        }</span><span class="cov0" title="0"> else {
                fmt.Printf("Failed to open connection\n")
        }</span>

        // Create correct tables
        <span class="cov10" title="7">db.AutoMigrate(&amp;models.Avatar{}, &amp;models.Channel{}, &amp;models.Emoji{}, &amp;models.Folder{},
                models.Member{}, &amp;models.Message{}, &amp;models.Organisation{}, &amp;models.Parameter{},
                &amp;models.Role{}, &amp;models.User{})

        // Will not set CreatedAt and UpdatedAt on .Create() call
        db.Callback().Create().Remove("gorm:update_time_stamp")
        db.Callback().Create().Remove("gorm:save_associations")

        // Will not update UpdatedAt on .Save() call
        db.Callback().Update().Remove("gorm:update_time_stamp")
        db.Callback().Update().Remove("gorm:save_associations")

        if db.NewRecord(&amp;models.Owner) </span><span class="cov9" title="6">{
                fmt.Printf("\nAdding Owner Role ......\n")
                db.Create(&amp;models.Owner)
                if !db.NewRecord(&amp;models.Owner) </span><span class="cov1" title="1">{
                        fmt.Printf("Owner role added\n")
                }</span><span class="cov8" title="5"> else {
                        fmt.Printf("Owner role NOT ADDED :'(\n")
                }</span>
        }<span class="cov1" title="1"> else {
                fmt.Printf("Owner role already exist\n")
        }</span>
        <span class="cov10" title="7">if db.NewRecord(&amp;models.Admin) </span><span class="cov9" title="6">{
                fmt.Printf("\nAdding Admin Role ......\n")
                db.Create(&amp;models.Admin)
                if !db.NewRecord(&amp;models.Admin) </span><span class="cov1" title="1">{
                        fmt.Printf("Admin role added\n")
                }</span><span class="cov8" title="5"> else {
                        fmt.Printf("Admin role NOT ADDED :'(\n")
                }</span>
        }<span class="cov1" title="1"> else {
                fmt.Printf("Owner role already exist\n")
        }</span>
        <span class="cov10" title="7">if db.NewRecord(&amp;models.Standart) </span><span class="cov9" title="6">{
                fmt.Printf("\nAdding Standart Role ......\n")
                db.Create(&amp;models.Standart)
                if !db.NewRecord(&amp;models.Standart) </span><span class="cov1" title="1">{
                        fmt.Printf("Standart role added\n")
                }</span><span class="cov8" title="5"> else {
                        fmt.Printf("Standart role NOT ADDED :'(\n")
                }</span>
        }<span class="cov1" title="1"> else {
                fmt.Printf("Owner role already exist\n")
        }</span>
        <span class="cov10" title="7">if db.NewRecord(&amp;models.Guest) </span><span class="cov9" title="6">{
                fmt.Printf("\nAdding Guest Role ......\n")
                db.Create(&amp;models.Guest)
                if !db.NewRecord(&amp;models.Guest) </span><span class="cov1" title="1">{
                        fmt.Printf("Guest role added\n")
                }</span><span class="cov8" title="5"> else {
                        fmt.Printf("Guest role NOT ADDED :'(\n")
                }</span>
        }<span class="cov1" title="1"> else {
                fmt.Printf("Owner role already exist\n")
        }</span>
        <span class="cov10" title="7">ds.Db = db
        ds.Err = err
        if err == nil </span><span class="cov10" title="7">{
                fmt.Printf("\n######## Intialisating DONE ########\n")
        }</span><span class="cov0" title="0"> else {
                fmt.Printf("\n######## Intialisating Failed ########\n")
        }</span>
}

func (ds *dbStore) roleInitSave(role models.Role) *u.AppError <span class="cov0" title="0">{
        db := ds.Db
        transaction := db.Begin()
        if appError := role.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Save.role.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov0" title="0">if !transaction.NewRecord(role) </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Save", "save.transaction.create.already_exist", nil, "Role Name: "+role.RoleName)
        }</span>
        <span class="cov0" title="0">if err := transaction.Create(&amp;role).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Save", "save.transaction.create.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}

// CloseConnection close database connection
func (ds *dbStore) CloseConnection() <span class="cov0" title="0">{
        db := *ds.Db
        defer db.Close()
        ds.Db = &amp;gorm.DB{}
}</span>

// Store interface the Stores and usefull DB functions
type Store interface {
        Organisation() OrganisationStore
        Avatar() AvatarStore
        Emoji() EmojiStore
        InitConnection()
        CloseConnection()
}

/*AvatarStore interface the avatar communication */
type AvatarStore interface {
        Save(avatar *models.Avatar, ds dbStore) *u.AppError
        Update(avatar *models.Avatar, newAvatar *models.Avatar, ds dbStore) *u.AppError
        GetByName(avatarName string, ds dbStore) *models.Avatar
        GetByLink(avatarLink string, ds dbStore) *models.Avatar
        GetAll(ds dbStore) *[]models.Avatar
        Delete(avatar *models.Avatar, ds dbStore) *u.AppError
}

/*ChannelStore interface the channel communication*/
type ChannelStore interface {
        Save(channel *models.Channel, ds dbStore) *u.AppError
        Update(channel *models.Channel, newChannel *models.Channel, ds dbStore) *u.AppError
        GetByName(channelName string, ds dbStore) *models.Channel
        GetByType(channelType string, ds dbStore) *models.Channel
        GetPublic(ds dbStore) *[]models.Channel
        GetPrivate(ds dbStore) *[]models.Channel
        GetAll(ds dbStore) *[]models.Channel
        Delete(channel *models.Channel, ds dbStore) *u.AppError
}

/*EmojiStore interface the emoji communication*/
type EmojiStore interface {
        Save(emoji *models.Emoji, ds dbStore) *u.AppError
        Update(emoji *models.Emoji, newEmoji *models.Emoji, ds dbStore) *u.AppError
        GetByName(emojiName string, ds dbStore) *models.Emoji
        GetByShortcut(emojiShortcut string, ds dbStore) *models.Emoji
        GetByLink(emojiLink string, ds dbStore) *models.Emoji
        GetAll(ds dbStore) *models.Emoji
        Delete(emoji *models.Emoji, ds dbStore) *u.AppError
}

/*FolderStore interface communication with message table*/
type FolderStore interface {
        Save(message *models.Folder, ds dbStore) *u.AppError
        Update(message *models.Folder, newFolder *models.Folder, ds dbStore) *u.AppError
        GetByName(messageName string, ds dbStore) *[]models.Folder
        GetByType(messageType string, ds dbStore) *[]models.Folder
        GetByLink(messageLink string, ds dbStore) *[]models.Folder
        GetByMessage(message *models.Message, ds dbStore) *[]models.Folder
        GetAll(ds dbStore) *[]models.Folder
        Delete(message *models.Folder, ds dbStore) *u.AppError
}

/*MemberStore interface communication with member table*/
type MemberStore interface {
        Save(emoji *models.Emoji, ds dbStore) *u.AppError
        Update(emoji *models.Emoji, newEmoji *models.Emoji, ds dbStore) *u.AppError
        GetByUser()
        GetByChannel()
        GetByRole()
        GetAll(ds dbStore) *models.Emoji
        Delete(emoji *models.Emoji, ds dbStore) *u.AppError
}

/*MessageStore interface communication with message table*/
type MessageStore interface {
        Save(message *models.Message, ds dbStore) *u.AppError
        Update(message *models.Message, newMessage *models.Message, ds dbStore) *u.AppError
        GetByDate(messageDate int, ds dbStore) *[]models.Message
        GetByCreator(creator *models.User, ds dbStore) *[]models.Message
        GetByChannel(channel *models.Channel, ds dbStore) *[]models.Message
        GetAll(ds dbStore) *[]models.Message
        Delete(message *models.Message, ds dbStore) *u.AppError
}

/*OrganisationStore interface the organisation communication
Organisation is unique in the database. So they are no use of providing an user to get.
Delete is useless as we will down the docker stack in case an organisation leace.
*/
type OrganisationStore interface {
        Save(organisation *models.Organisation, ds dbStore) *u.AppError
        Update(organisation *models.Organisation, newOrganisation *models.Organisation, ds dbStore) *u.AppError
        Get(ds dbStore) *models.Organisation
}

/*ParameterStore interface the parameter communication*/
type ParameterStore interface {
        Save(parameter *models.Parameter, ds dbStore) *u.AppError
        Update(parameter *models.Parameter, newParameter *models.Parameter, ds dbStore) *u.AppError
        GetAll(ds dbStore) *models.Parameter
}

/*RoleStore interface the role communication*/
type RoleStore interface {
        Save(role *models.Role, ds dbStore) *u.AppError
        Update(role *models.Role, newRole *models.Role, ds dbStore) *u.AppError
        GetByName(roleName string, ds dbStore) *models.Role
        GetByRights(roleRights *models.Role, ds dbStore) *[]models.Role
        GetAll(ds dbStore) *[]models.Role
        Delete(role *models.Role, ds dbStore) *u.AppError
}

/*UserStore interface the user communication*/
type UserStore interface {
        Save(user *models.User, ds dbStore) *u.AppError
        Update(user *models.User, newUser *models.User, ds dbStore) *u.AppError
        GetByUserName(userName string, ds dbStore) *models.User
        GetByEmail(userEmail string, ds dbStore) *models.User
        GetOrderedByDate(userDate int, ds dbStore) *[]models.User
        GetDeleted(ds dbStore) *[]models.User
        GetByNickName(nickName string, ds dbStore) *models.User
        GetByFirstName(firstName string, ds dbStore) *[]models.User
        GetByLastName(lastName string, ds dbStore) *[]models.User
        GetByRole(role *models.Role, ds dbStore) *[]models.User
        GetByChannel(channel *models.Channel, ds dbStore) *[]models.User
        GetAll(ds dbStore) *[]models.User
        Delete(user *models.User, ds dbStore) *u.AppError
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package datastores

import (
        "models"
        u "utils"
)

// EmojiStoreImpl implement EmojiStore interface
type EmojiStoreImpl struct {
        EmojiStore
}

// Save Use to save emoji in BB
func (esi EmojiStoreImpl) Save(emoji *models.Emoji, ds dbStore) *u.AppError <span class="cov10" title="40">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := emoji.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("emojiStoreImpl.Save.emoji.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov10" title="40">if !transaction.NewRecord(emoji) </span><span class="cov1" title="1">{
                transaction.Rollback()
                return u.NewLocAppError("emojiStoreImpl.Save", "save.transaction.create.already_exist", nil, "Emoji Name: "+emoji.Name)
        }</span>
        <span class="cov9" title="39">if err := transaction.Create(&amp;emoji).Error; err != nil </span><span class="cov7" title="17">{
                transaction.Rollback()
                return u.NewLocAppError("emojiStoreImpl.Save", "save.transaction.create.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov8" title="22">transaction.Commit()
        return nil</span>
}

// Update Used to update emoji in DB
func (esi EmojiStoreImpl) Update(emoji *models.Emoji, newEmoji *models.Emoji, ds dbStore) *u.AppError <span class="cov5" title="6">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := emoji.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("emojiStoreImpl.Update.emojiOld.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov5" title="6">if appError := newEmoji.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("emojiStoreImpl.Update.emojiNew.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov5" title="6">if err := transaction.Model(&amp;emoji).Updates(&amp;newEmoji).Error; err != nil </span><span class="cov4" title="5">{
                transaction.Rollback()
                return u.NewLocAppError("emojiStoreImpl.Update", "update.transaction.updates.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov1" title="1">transaction.Commit()
        return nil</span>
}

// GetAll Used to get emoji from DB
func (esi EmojiStoreImpl) GetAll(ds dbStore) *[]models.Emoji <span class="cov4" title="5">{
        db := *ds.Db
        emojis := []models.Emoji{}
        db.Find(&amp;emojis)
        return &amp;emojis
}</span>

// GetByName Used to get emoji from DB
func (esi EmojiStoreImpl) GetByName(emojiName string, ds dbStore) *models.Emoji <span class="cov2" title="2">{
        db := *ds.Db
        emoji := models.Emoji{}
        db.Where("name = ?", emojiName).First(&amp;emoji)
        return &amp;emoji
}</span>

// GetByShortcut Used to get emoji from DB
func (esi EmojiStoreImpl) GetByShortcut(EmojiShortcut string, ds dbStore) *models.Emoji <span class="cov1" title="1">{
        db := *ds.Db
        emoji := models.Emoji{}
        db.Where("shortcut = ?", EmojiShortcut).First(&amp;emoji)
        return &amp;emoji
}</span>

// GetByLink Used to get emoji from DB
func (esi EmojiStoreImpl) GetByLink(emojiLink string, ds dbStore) *models.Emoji <span class="cov2" title="2">{
        db := *ds.Db
        emoji := models.Emoji{}
        db.Where("link = ?", emojiLink).First(&amp;emoji)
        return &amp;emoji
}</span>

// Delete Used to get emoji from DB
func (esi EmojiStoreImpl) Delete(emoji *models.Emoji, ds dbStore) *u.AppError <span class="cov4" title="4">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := emoji.IsValid(); appError != nil </span><span class="cov3" title="3">{
                transaction.Rollback()
                return u.NewLocAppError("emojiStoreImpl.Delete.emoji.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov1" title="1">if err := transaction.Delete(&amp;emoji).Error; err != nil </span><span class="cov1" title="1">{
                transaction.Rollback()
                return u.NewLocAppError("emojiStoreImpl.Delete", "update.transaction.delete.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package datastores

import (
        "models"
        u "utils"
)

// OrganisationStoreImpl implements OrganisationSotre interface
type OrganisationStoreImpl struct {
        OrganisationStore
}

// Save Use to save data in BB
func (osi OrganisationStoreImpl) Save(organisation *models.Organisation, ds dbStore) *u.AppError <span class="cov10" title="17">{
        db := *ds.Db
        transaction := db.Begin()
        organisation.PreSave()
        if appError := organisation.IsValid(); appError != nil </span><span class="cov8" title="12">{
                transaction.Rollback()
                return u.NewLocAppError("organisationStoreImpl.Save.organisation.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov6" title="5">if !transaction.NewRecord(organisation) </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("organisationStoreImpl.Save", "save.transaction.create.already_exist", nil, "Organisation Name: "+organisation.OrganisationName)
        }</span>
        <span class="cov6" title="5">if err := transaction.Create(&amp;organisation).Error; err != nil </span><span class="cov6" title="5">{
                transaction.Rollback()
                return u.NewLocAppError("organisationStoreImpl.Save", "save.transaction.create.encounterError: "+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}

// Update Used to update data in DB
func (osi OrganisationStoreImpl) Update(organisation *models.Organisation, newOrganisation *models.Organisation, ds dbStore) *u.AppError <span class="cov0" title="0">{
        db := *ds.Db
        transaction := db.Begin()
        newOrganisation.PreSave()
        if appError := organisation.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("organisationStoreImpl.Update.organisationOld.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov0" title="0">if appError := newOrganisation.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("organisationStoreImpl.Update.organisationNew.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov0" title="0">if err := transaction.Model(&amp;organisation).Updates(&amp;newOrganisation).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("organisationStoreImpl.Update", "update.transaction.updates.encounterError: "+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}

// Get Used to get organisation from DB
func (osi OrganisationStoreImpl) Get(ds dbStore) *models.Organisation <span class="cov1" title="1">{
        db := *ds.Db
        organisation := models.Organisation{}
        db.First(&amp;organisation)
        return &amp;organisation
}</span>
</pre>
		
		<pre class="file" id="file5" style="display: none">package datastores

import (
        "models"
        u "utils"
)

// ParameterStoreImpl implement ParameterStore interface
type ParameterStoreImpl struct {
        ParameterStore
}

// Save Use to save parameter in BB
func (psi ParameterStoreImpl) Save(parameter *models.Parameter, ds dbStore) *u.AppError <span class="cov10" title="23">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := parameter.IsValid(); appError != nil </span><span class="cov7" title="9">{
                transaction.Rollback()
                return u.NewLocAppError("parameterStoreImpl.Save.parameter.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov8" title="14">if !transaction.NewRecord(parameter) </span><span class="cov1" title="1">{
                transaction.Rollback()
                return u.NewLocAppError("parameterStoreImpl.Save", "save.transaction.create.already_exist", nil, "")
        }</span>
        <span class="cov8" title="13">if err := transaction.Create(&amp;parameter).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("parameterStoreImpl.Save", "save.transaction.create.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov8" title="13">transaction.Commit()
        return nil</span>
}

// Update Used to update parameter in DB
func (psi ParameterStoreImpl) Update(parameter *models.Parameter, newParameter *models.Parameter, ds dbStore) *u.AppError <span class="cov9" title="19">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := parameter.IsValid(); appError != nil </span><span class="cov7" title="9">{
                transaction.Rollback()
                return u.NewLocAppError("parameterStoreImpl.Update.parameterOld.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov7" title="10">if appError := newParameter.IsValid(); appError != nil </span><span class="cov7" title="9">{
                transaction.Rollback()
                return u.NewLocAppError("parameterStoreImpl.Update.parameterNew.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov1" title="1">if err := transaction.Model(&amp;parameter).Updates(&amp;newParameter).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("parameterStoreImpl.Update", "update.transaction.updates.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov1" title="1">transaction.Commit()
        return nil</span>
}

// Get Used to get parameter from DB
func (psi ParameterStoreImpl) Get(ds dbStore) *models.Parameter <span class="cov2" title="2">{
        db := *ds.Db
        parameter := models.Parameter{}
        db.First(&amp;parameter)
        return &amp;parameter
}</span>
</pre>
		
		<pre class="file" id="file6" style="display: none">package datastores

import (
        "models"
        "strings"
        u "utils"
)

// RoleStoreImpl Used to implement RoleStore interface
type RoleStoreImpl struct {
        RoleStore
}

// Save Use to save role in BB
func (rsi RoleStoreImpl) Save(role *models.Role, ds dbStore) *u.AppError <span class="cov10" title="36">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := role.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Save.role.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov10" title="36">if !transaction.NewRecord(role) </span><span class="cov1" title="1">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Save", "save.transaction.create.already_exist", nil, "Role Name: "+role.RoleName)
        }</span>
        <span class="cov9" title="35">if err := transaction.Create(&amp;role).Error; err != nil </span><span class="cov7" title="15">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Save", "save.transaction.create.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov8" title="20">transaction.Commit()
        return nil</span>
}

// Update Used to update role in DB
func (rsi RoleStoreImpl) Update(role *models.Role, newRole *models.Role, ds dbStore) *u.AppError <span class="cov5" title="5">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := role.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Update.roleOld.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov5" title="5">if appError := newRole.IsValid(); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Update.roleNew.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov5" title="5">transitionRole := models.Role{
                CanUsePrivate: newRole.CanUsePrivate,
                CanModerate:   newRole.CanModerate,
                CanArchive:    newRole.CanArchive,
                CanInvite:     newRole.CanInvite,
                CanManage:     newRole.CanManage,
                CanManageUser: newRole.CanManageUser,
        }
        json := transitionRole.ToJSON()
        rights := u.StringInterfaceFromJSON(strings.NewReader(json))
        if err := transaction.Model(&amp;role).Updates(&amp;newRole).Error; err != nil </span><span class="cov5" title="5">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Update", "update.transaction.updates.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">if err := transaction.Model(&amp;role).Updates(rights).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Update", "update.transaction.updates.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}

// GetAll Used to get role from DB
func (rsi RoleStoreImpl) GetAll(ds dbStore) *[]models.Role <span class="cov5" title="5">{
        db := *ds.Db
        roles := []models.Role{}
        db.Find(&amp;roles)
        return &amp;roles
}</span>

// GetByName Used to get role from DB
func (rsi RoleStoreImpl) GetByName(roleName string, ds dbStore) *models.Role <span class="cov5" title="7">{
        db := *ds.Db
        role := models.Role{}
        db.Where("roleName = ?", roleName).First(&amp;role)
        return &amp;role
}</span>

// GetByRights Used to get role from DB
// You can only search for roles set to true.
func (rsi RoleStoreImpl) GetByRights(roleRights *models.Role, ds dbStore) *[]models.Role <span class="cov1" title="1">{
        db := *ds.Db
        roles := []models.Role{}
        db.Where(&amp;roleRights).Find(&amp;roles)
        return &amp;roles
}</span>

// Delete Used to get role from DB
func (rsi RoleStoreImpl) Delete(role *models.Role, ds dbStore) *u.AppError <span class="cov4" title="4">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := role.IsValid(); appError != nil </span><span class="cov3" title="3">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Delete.role.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov1" title="1">if err := transaction.Delete(&amp;role).Error; err != nil </span><span class="cov1" title="1">{
                transaction.Rollback()
                return u.NewLocAppError("roleStoreImpl.Delete", "update.transaction.delete.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}
</pre>
		
		<pre class="file" id="file7" style="display: none">package datastores

import (
        "fmt"
        "models"
        u "utils"
)

// UserStoreImpl Used to implement UserStore interface
type UserStoreImpl struct {
        UserStore
}

// Save Use to save user in BB
func (usi UserStoreImpl) Save(user *models.User, ds dbStore) *u.AppError <span class="cov10" title="34">{
        db := *ds.Db
        transaction := db.Begin()
        user.PreSave()
        if appError := user.IsValid(false); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("userStoreImpl.Save.user.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov10" title="34">if !transaction.NewRecord(user) </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("userStoreImpl.Save", "save.transaction.create.already_exist", nil, "User Name: "+user.Username)
        }</span>
        <span class="cov10" title="34">fmt.Printf("IDRole is : %d, InUserRole ID is : %d", user.IDRole, user.Role.IDRole)
        if err := transaction.Debug().Create(&amp;user).Error; err != nil </span><span class="cov10" title="34">{
                transaction.Rollback()
                return u.NewLocAppError("userStoreImpl.Save", "save.transaction.create.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}

// Update Used to update user in DB
func (usi UserStoreImpl) Update(user *models.User, newUser *models.User, ds dbStore) *u.AppError <span class="cov5" title="6">{
        db := *ds.Db
        transaction := db.Begin()
        newUser.PreUpdate()
        if appError := user.IsValid(false); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("userStoreImpl.Update.userOld.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov5" title="6">if appError := newUser.IsValid(true); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("userStoreImpl.Update.userNew.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov5" title="6">if err := transaction.Model(&amp;user).Updates(&amp;newUser).Error; err != nil </span><span class="cov5" title="6">{
                transaction.Rollback()
                return u.NewLocAppError("userStoreImpl.Update", "update.transaction.updates.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}

// GetAll Used to get user from DB
func (usi UserStoreImpl) GetAll(ds dbStore) *[]models.User <span class="cov2" title="2">{
        db := *ds.Db
        users := []models.User{}
        db.Find(&amp;users)
        return &amp;users
}</span>

// GetByUserName Used to get user from DB
func (usi UserStoreImpl) GetByUserName(userName string, ds dbStore) *models.User <span class="cov2" title="2">{
        db := *ds.Db
        user := models.User{}
        db.Where("userName = ?", userName).First(&amp;user)
        return &amp;user
}</span>

// GetByEmail Used to get user from DB by email
func (usi UserStoreImpl) GetByEmail(userEmail string, ds dbStore) *models.User <span class="cov1" title="1">{
        db := *ds.Db
        user := models.User{}
        db.Where("email = ?", userEmail).First(&amp;user)
        return &amp;user
}</span>

// GetOrderedByDate get all users ordered by date
func (usi UserStoreImpl) GetOrderedByDate(userDate int, ds dbStore) *[]models.User <span class="cov0" title="0">{
        db := *ds.Db
        users := []models.User{}
        db.Order("updatedAt, userName, email").Find(&amp;users)
        return &amp;users
}</span>

// GetDeleted get deleted users
func (usi UserStoreImpl) GetDeleted(ds dbStore) *[]models.User <span class="cov0" title="0">{
        db := *ds.Db
        users := []models.User{}
        db.Where("deleted = ?", true).First(&amp;users)
        return &amp;users
}</span>

// GetByNickName get user from nick name
func (usi UserStoreImpl) GetByNickName(nickName string, ds dbStore) *models.User <span class="cov0" title="0">{
        db := *ds.Db
        user := models.User{}
        db.Where("nickName = ?", nickName).First(&amp;user)
        return &amp;user
}</span>

// GetByFirstName get user by first name
func (usi UserStoreImpl) GetByFirstName(firstName string, ds dbStore) *[]models.User <span class="cov0" title="0">{
        db := *ds.Db
        users := []models.User{}
        db.Where("firstName = ?", firstName).Find(&amp;users)
        return &amp;users
}</span>

// GetByLastName get user from last name
func (usi UserStoreImpl) GetByLastName(lastName string, ds dbStore) *[]models.User <span class="cov0" title="0">{
        db := *ds.Db
        users := []models.User{}
        db.Where("lastName = ?", lastName).Find(&amp;users)
        return &amp;users
}</span>

// GetByRole get user from rolme
func (usi UserStoreImpl) GetByRole(role *models.Role, ds dbStore) *[]models.User <span class="cov1" title="1">{
        db := *ds.Db
        users := []models.User{}
        db.Debug().Model(role).Related(&amp;users, "Role")
        // db.Debug().Model(&amp;role).Association("Role").Find(&amp;users)
        return &amp;users
}</span>

// Need MEMEBER functions to do it
// GetByChannel Get user in a channem
// func (usi UserStoreImpl) GetByChannel(channel *models.Channel, ds dbStore) *[]models.User {

// }

//

// Delete Used to get user from DB
func (usi UserStoreImpl) Delete(user *models.User, ds dbStore) *u.AppError <span class="cov0" title="0">{
        db := *ds.Db
        transaction := db.Begin()
        if appError := user.IsValid(true); appError != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("userStoreImpl.Delete.user.PreSave", appError.ID, nil, appError.DetailedError)
        }</span>
        <span class="cov0" title="0">if err := transaction.Delete(&amp;user).Error; err != nil </span><span class="cov0" title="0">{
                transaction.Rollback()
                return u.NewLocAppError("userStoreImpl.Delete", "update.transaction.delete.encounterError :"+err.Error(), nil, "")
        }</span>
        <span class="cov0" title="0">transaction.Commit()
        return nil</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
